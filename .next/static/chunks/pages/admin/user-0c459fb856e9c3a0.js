(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[518],{9280:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/user",function(){return c(9601)}])},9601:function(d,b,a){"use strict";a.r(b),a.d(b,{"__N_SSP":function(){return I},"default":function(){return J}});var e=a(5893),f=a(7294),g=a(7887),h=a(7283),i=a(319),j=a(682),k=a(1608),l=a(1555),m=a(2878),n=a(2318),o=a(4716),p=a(5147),q=a(343),r=a(5005),s=a(782),c=a(7422),t=a.n(c),u=a(3907),v=a(9738);function w(c,a){(null==a||a>c.length)&&(a=c.length);for(var b=0,d=new Array(a);b<a;b++)d[b]=c[b];return d}function x(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function y(d){for(var a=1;a<arguments.length;a++){var c=null!=arguments[a]?arguments[a]:{},b=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(b=b.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),b.forEach(function(a){x(d,a,c[a])})}return d}function z(a,b){return function(a){if(Array.isArray(a))return a}(a)||function(b,e){var f,g,a=null==b?null:"undefined"!=typeof Symbol&&b[Symbol.iterator]||b["@@iterator"];if(null!=a){var c=[],d=!0,h=!1;try{for(a=a.call(b);!(d=(f=a.next()).done)&&(c.push(f.value),!e||c.length!==e);d=!0);}catch(i){h=!0,g=i}finally{try{d||null==a.return||a.return()}finally{if(h)throw g}}return c}}(a,b)||B(a,b)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(b,a){return a||(a=b.slice(0)),Object.freeze(Object.defineProperties(b,{raw:{value:Object.freeze(a)}}))}function B(a,c){if(a){if("string"==typeof a)return w(a,c);var b=Object.prototype.toString.call(a).slice(8,-1);if("Object"===b&&a.constructor&&(b=a.constructor.name),"Map"===b||"Set"===b)return Array.from(b);if("Arguments"===b||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(b))return w(a,c)}}function C(){var a=A(["\n    query users($username: String!){\n      users(username: $username){\n        username\n        roles {\n          name\n        }\n      }\n\n      roles {\n        name\n        permissions\n      }\n\n      permissions\n    }\n  "]);return C=function(){return a},a}function D(){var a=A(["\n  mutation updateUserRoles($username: String!, $roles: [String]!){\n    updateUserRoles(username: $username, roles: $roles)\n  }\n  "]);return D=function(){return a},a}function E(){var a=A(["\n  mutation DeleteUser($username: String!){\n    deleteUser(username: $username)\n  }\n  "]);return E=function(){return a},a}function F(){var a=A(["\n  mutation DeleteRole($name:String!){\n    deleteRole(name: $name)\n  }\n  "]);return F=function(){return a},a}function G(){var a=A(["\n  mutation UpdateRole($key: String!, $name:String!, $permissions:[String]!){\n    updateRole(key: $key, name: $name, permissions: $permissions){\n      name\n    }\n  }\n  "]);return G=function(){return a},a}function H(){var a=A(["\n  mutation CreateRole($name:String!, $permissions: [String]!){\n    createRole(name: $name, permissions: $permissions) {\n      name\n    }\n  }\n  "]);return H=function(){return a},a}var I=!0;function J(){var b=(0,g.a)((0,h.Ps)(C()),{variables:{username:""}}),a=b.data,c=b.refetch;return(0,e.jsxs)(j.Z,{children:[(0,e.jsx)(k.Z,{className:"site-form blackblock mt-3",children:(0,e.jsxs)(l.Z,{children:[(0,e.jsx)(k.Z,{children:(0,e.jsx)(l.Z,{children:(0,e.jsx)(m.Z.Group,{children:(0,e.jsxs)(n.Z,{children:[(0,e.jsx)(n.Z.Text,{children:"\uD83D\uDD0E"}),(0,e.jsx)(o.Z,{onChange:function(a){a.persist(),a.preventDefault();var b=a.target.value;b.length<3||c({username:b})}})]})})})}),(0,e.jsx)(k.Z,{className:"mt-2",children:(0,e.jsx)(l.Z,{children:(0,e.jsxs)(p.Z,{variant:"dark",hover:!0,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Username"}),(0,e.jsx)("th",{children:"Roles"}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:a&&a.users.map(function(b){return(0,e.jsx)(K,y({},b,{roleList:a.roles,refetch:c}),b.username)})})]})})})]})}),(0,e.jsx)(k.Z,{className:"site-form blackblock mt-3",children:(0,e.jsx)(l.Z,{children:(0,e.jsxs)(p.Z,{variant:"dark",hover:!0,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Role"}),a&&a.permissions.map(function(a,b){return(0,e.jsx)("th",{children:a},b)}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:a&&a.roles.map(function(b){return(0,e.jsx)(L,y({},b,{permissionList:a.permissions}),b.name)})})]})})}),(0,e.jsx)(M,{})]})}function K(a){var b=a.username,j=a.roles,m=a.roleList,t=a.refetch,c=z((0,i.D)((0,h.Ps)(D())),2),w=c[0],n=c[1].loading,d=z((0,i.D)((0,h.Ps)(E())),2),x=d[0],o=d[1].removeLoading,g=(0,f.useState)(!1),p=g[0],y=g[1],A=function(a){w({variables:{username:b,roles:a.map(function(a){return a.value})}}).then(function(a){s.Am.success("Updated user succesfully!")}).catch(function(a){console.log(a),s.Am.error(a.message,{autoclose:!1})})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(q.Z,{centered:!0,show:p,toggle:function(){return y(!p)},children:(0,e.jsxs)(q.Z.Body,{className:"m-3",style:{color:"black"},children:[(0,e.jsx)(k.Z,{children:(0,e.jsx)(l.Z,{children:'Delete user "'.concat(b,'"?')})}),(0,e.jsx)(k.Z,{className:"mt-2",children:(0,e.jsxs)(l.Z,{children:[(0,e.jsx)(r.Z,{color:"primary",className:"mx-2",onClick:function(){x({variables:{username:b}}).then(function(a){s.Am.success('Deleted user "'.concat(b,'" succesfully')),t()}).catch(function(a){console.log(a),s.Am.error('Failed to delete user "'.concat(b,'"'))}).finally(function(){return y(!p)})},children:o?(0,e.jsx)(v.Z,{dev:!0}):"Yes"}),(0,e.jsx)(r.Z,{color:"primary",className:"mx-2",onClick:function(){return y(!p)},children:"No"})]})})]})}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:b}),(0,e.jsx)("td",{children:(0,e.jsx)(u.d7,{loading:n,onChange:function(a){return A(a)},defaultValue:j.map(function(b){var a=b.name;return{label:a,value:a}}),options:m.map(function(b){var a=b.name;return{label:a,value:a}})})}),(0,e.jsx)("td",{children:(0,e.jsx)(r.Z,{className:"mr-2",onClick:function(){return y(!p)},children:"Remove"})})]})]})}function L(a){var c=a.name,g=a.permissions,b=a.permissionList,d=(0,f.useRef)(null),j=(0,f.useMemo)(function(){return Array(b.length).fill().map(function(){return(0,f.createRef)()})},[b]),k=z((0,i.D)((0,h.Ps)(F())),1)[0],l=z((0,i.D)((0,h.Ps)(G())),1)[0];return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("input",{style:{width:"100%"},ref:d,type:"text",className:"m-auto",defaultValue:c})}),b.map(function(a,b){return(0,e.jsx)("td",{children:(0,e.jsx)("input",{ref:j[b],type:"checkbox",className:"m-auto",defaultChecked:g.includes(a)})},a)}),(0,e.jsxs)("td",{children:[(0,e.jsx)(r.Z,{className:"mr-2",onClick:function(){var a=[];j.forEach(function(c,d){c.current.checked&&a.push(b[d])}),l({variables:{key:c,name:d.current.value,permissions:a}}).then(function(a){s.Am.success('Updated "'.concat(c,'" role succesfully!'))}).catch(function(a){console.log(a),s.Am.error(a.message,{autoclose:!1})})},children:"Save"}),(0,e.jsx)(r.Z,{onClick:function(){k({variables:{name:c}}).then(function(a){s.Am.success('Removed "'.concat(c,'" role succesfully!'))}).catch(function(a){console.log(a),s.Am.error(a.message,{autoclose:!1})})},children:"Remove"})]})]})}function M(){var a=z((0,i.D)((0,h.Ps)(H())),1)[0];return(0,e.jsx)("div",{className:"site-form blackblock mt-3 p-3",children:(0,e.jsx)(m.Z,{onSubmit:function(b){b.preventDefault(),b.persist();var c=t()(b.target,{hash:!0});c.permissions=[],a({variables:c}).then(function(a){s.Am.success('Added "'.concat(b.target.elements.name.value,'" role succesfully!')),b.target.reset()}).catch(function(a){console.log(a),s.Am.error(a.message,{autoclose:!1})})},children:(0,e.jsxs)(k.Z,{children:[(0,e.jsx)(l.Z,{children:(0,e.jsxs)(m.Z.Group,{children:[(0,e.jsx)(m.Z.Label,{htmlFor:"name",children:"Name:"}),(0,e.jsx)(o.Z,{type:"text",name:"name",required:!0})]})}),(0,e.jsx)(l.Z,{className:"mb-3 mt-auto",children:(0,e.jsx)(r.Z,{type:"submit",color:"primary",children:"Add Role"})})]})})})}},2318:function(h,c,a){"use strict";var d=a(4184),i=a.n(d),e=a(7294),f=a(6611),j=a(6792),k=a(6558),l=a(3045),m=a(5893);let g=(0,f.Z)("input-group-text",{Component:"span"}),b=e.forwardRef(({bsPrefix:a,size:b,hasValidation:c,className:d,as:f="div",...g},h)=>{a=(0,j.vE)(a,"input-group");let k=(0,e.useMemo)(()=>({}),[]);return(0,m.jsx)(l.Z.Provider,{value:k,children:(0,m.jsx)(f,{ref:h,...g,className:i()(d,a,b&&`${a}-${b}`,c&&"has-validation")})})});b.displayName="InputGroup",c.Z=Object.assign(b,{Text:g,Radio:a=>(0,m.jsx)(g,{children:(0,m.jsx)(k.Z,{type:"radio",...a})}),Checkbox:a=>(0,m.jsx)(g,{children:(0,m.jsx)(k.Z,{type:"checkbox",...a})})})},5147:function(f,b,a){"use strict";var c=a(4184),g=a.n(c),d=a(7294),h=a(6792),i=a(5893);let e=d.forwardRef(({bsPrefix:j,className:k,striped:l,bordered:m,borderless:n,hover:o,size:d,variant:e,responsive:b,...p},q)=>{let a=(0,h.vE)(j,"table"),r=g()(k,a,e&&`${a}-${e}`,d&&`${a}-${d}`,l&&`${a}-striped`,m&&`${a}-bordered`,n&&`${a}-borderless`,o&&`${a}-hover`),f=(0,i.jsx)("table",{...p,className:r,ref:q});if(b){let c=`${a}-responsive`;return"string"==typeof b&&(c=`${c}-${b}`),(0,i.jsx)("div",{className:c,children:f})}return f});b.Z=e}},function(a){a.O(0,[907,774,888,179],function(){return a(a.s=9280)}),_N_E=a.O()}])