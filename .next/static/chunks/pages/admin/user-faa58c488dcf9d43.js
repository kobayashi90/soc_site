(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[518],{9280:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/user",function(){return s(9601)}])},9601:function(e,n,s){"use strict";s.r(n),s.d(n,{__N_SSP:function(){return _},default:function(){return A}});var r=s(7297),t=s(5893),l=s(7294),c=s(1641),a=s(7283),i=s(319),o=s(682),u=s(4051),d=s(1555),m=s(2878),h=s(2318),x=s(4716),j=s(5147),f=s(343),p=s(5005),Z=s(782),v=s(7422),g=s.n(v),$=s(3907),b=s(9738);function y(){let e=(0,r.Z)(["\n    query users($search: String!){\n      users(search: $search){\n        username\n        roles {\n          name\n        }\n      }\n\n      roles {\n        name\n        permissions\n      }\n\n      permissions\n    }\n  "]);return y=function(){return e},e}function k(){let e=(0,r.Z)(["\n  mutation updateUserRoles($username: String!, $roles: [String]!){\n    updateUserRoles(username: $username, roles: $roles)\n  }\n  "]);return k=function(){return e},e}function N(){let e=(0,r.Z)(["\n  mutation DeleteUser($username: String!){\n    deleteUser(username: $username)\n  }\n  "]);return N=function(){return e},e}function R(){let e=(0,r.Z)(["\n  mutation DeleteRole($name:String!){\n    deleteRole(name: $name)\n  }\n  "]);return R=function(){return e},e}function D(){let e=(0,r.Z)(["\n  mutation UpdateRole($key: String!, $name:String!, $permissions:[String]!){\n    updateRole(key: $key, name: $name, permissions: $permissions){\n      name\n    }\n  }\n  "]);return D=function(){return e},e}function S(){let e=(0,r.Z)(["\n  mutation CreateRole($name:String!, $permissions: [String]!){\n    createRole(name: $name, permissions: $permissions) {\n      name\n    }\n  }\n  "]);return S=function(){return e},e}var _=!0;function A(){let{data:e,refetch:n}=(0,c.a)((0,a.Ps)(y()),{variables:{search:""}});return(0,t.jsxs)(o.Z,{children:[(0,t.jsx)(u.Z,{className:"site-form blackblock mt-3",children:(0,t.jsxs)(d.Z,{children:[(0,t.jsx)(u.Z,{children:(0,t.jsx)(d.Z,{children:(0,t.jsx)(m.Z.Group,{children:(0,t.jsxs)(h.Z,{children:[(0,t.jsx)(h.Z.Text,{children:"\uD83D\uDD0E"}),(0,t.jsx)(x.Z,{onChange:function(e){e.persist(),e.preventDefault();let s=e.target.value;s.length<3||n({search:s})}})]})})})}),(0,t.jsx)(u.Z,{className:"mt-2",children:(0,t.jsx)(d.Z,{children:(0,t.jsxs)(j.Z,{variant:"dark",hover:!0,children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Username"}),(0,t.jsx)("th",{children:"Roles"}),(0,t.jsx)("th",{})]})}),(0,t.jsx)("tbody",{children:e&&e.users.map(s=>(0,t.jsx)(C,{...s,roleList:e.roles,refetch:n},s.username))})]})})})]})}),(0,t.jsx)(u.Z,{className:"site-form blackblock mt-3",children:(0,t.jsx)(d.Z,{children:(0,t.jsxs)(j.Z,{variant:"dark",hover:!0,children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Role"}),e&&e.permissions.map((e,n)=>(0,t.jsx)("th",{children:e},n)),(0,t.jsx)("th",{})]})}),(0,t.jsx)("tbody",{children:e&&e.roles.map(n=>(0,t.jsx)(w,{...n,permissionList:e.permissions},n.name))})]})})}),(0,t.jsx)(P,{})]})}function C(e){let{username:n,roles:s,roleList:r,refetch:c}=e,[o,{loading:m}]=(0,i.D)((0,a.Ps)(k())),[h,{removeLoading:x}]=(0,i.D)((0,a.Ps)(N())),[j,v]=(0,l.useState)(!1),g=e=>{o({variables:{username:n,roles:e.map(e=>e.value)}}).then(e=>{Z.Am.success("Updated user succesfully!")}).catch(e=>{console.log(e),Z.Am.error(e.message,{autoclose:!1})})};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.Z,{centered:!0,show:j,toggle:()=>v(!j),children:(0,t.jsxs)(f.Z.Body,{className:"m-3",style:{color:"black"},children:[(0,t.jsx)(u.Z,{children:(0,t.jsx)(d.Z,{children:'Delete user "'.concat(n,'"?')})}),(0,t.jsx)(u.Z,{className:"mt-2",children:(0,t.jsxs)(d.Z,{children:[(0,t.jsx)(p.Z,{color:"primary",className:"mx-2",onClick:function(){h({variables:{username:n}}).then(e=>{Z.Am.success('Deleted user "'.concat(n,'" succesfully')),c()}).catch(e=>{console.log(e),Z.Am.error('Failed to delete user "'.concat(n,'"'))}).finally(()=>v(!j))},children:x?(0,t.jsx)(b.Z,{dev:!0}):"Yes"}),(0,t.jsx)(p.Z,{color:"primary",className:"mx-2",onClick:()=>v(!j),children:"No"})]})})]})}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:n}),(0,t.jsx)("td",{children:(0,t.jsx)($.d7,{loading:m,onChange:e=>g(e),defaultValue:s.map(e=>{let{name:n}=e;return{label:n,value:n}}),options:r.map(e=>{let{name:n}=e;return{label:n,value:n}})})}),(0,t.jsx)("td",{children:(0,t.jsx)(p.Z,{className:"me-2",onClick:()=>v(!j),children:"Remove"})})]})]})}function w(e){let{name:n,permissions:s,permissionList:r}=e,c=(0,l.useRef)(null),o=(0,l.useMemo)(()=>Array(r.length).fill().map(()=>(0,l.createRef)()),[r]),[u]=(0,i.D)((0,a.Ps)(R())),[d]=(0,i.D)((0,a.Ps)(D()));return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)("input",{style:{width:"100%"},ref:c,type:"text",className:"m-auto",defaultValue:n})}),r.map((e,n)=>(0,t.jsx)("td",{children:(0,t.jsx)("input",{ref:o[n],type:"checkbox",className:"m-auto",defaultChecked:s.includes(e)})},e)),(0,t.jsxs)("td",{children:[(0,t.jsx)(p.Z,{className:"me-2",onClick:function(){let e=[];o.forEach((n,s)=>{n.current.checked&&e.push(r[s])}),d({variables:{key:n,name:c.current.value,permissions:e}}).then(e=>{Z.Am.success('Updated "'.concat(n,'" role succesfully!'))}).catch(e=>{console.log(e),Z.Am.error(e.message,{autoclose:!1})})},children:"Save"}),(0,t.jsx)(p.Z,{onClick:function(){u({variables:{name:n}}).then(e=>{Z.Am.success('Removed "'.concat(n,'" role succesfully!'))}).catch(e=>{console.log(e),Z.Am.error(e.message,{autoclose:!1})})},children:"Remove"})]})]})}function P(){let[e]=(0,i.D)((0,a.Ps)(S()));return(0,t.jsx)("div",{className:"site-form blackblock mt-3 p-3",children:(0,t.jsx)(m.Z,{onSubmit:function(n){n.preventDefault(),n.persist();let s=g()(n.target,{hash:!0});s.permissions=[],e({variables:s}).then(e=>{Z.Am.success('Added "'.concat(n.target.elements.name.value,'" role succesfully!')),n.target.reset()}).catch(e=>{console.log(e),Z.Am.error(e.message,{autoclose:!1})})},children:(0,t.jsxs)(u.Z,{children:[(0,t.jsx)(d.Z,{children:(0,t.jsxs)(m.Z.Group,{children:[(0,t.jsx)(m.Z.Label,{htmlFor:"name",children:"Name:"}),(0,t.jsx)(x.Z,{type:"text",name:"name",required:!0})]})}),(0,t.jsx)(d.Z,{className:"mb-3 mt-auto",children:(0,t.jsx)(p.Z,{type:"submit",color:"primary",children:"Add Role"})})]})})})}},2318:function(e,n,s){"use strict";var r=s(4184),t=s.n(r),l=s(7294),c=s(6611),a=s(6792),i=s(6558),o=s(3045),u=s(5893);let d=(0,c.Z)("input-group-text",{Component:"span"}),m=e=>(0,u.jsx)(d,{children:(0,u.jsx)(i.Z,{type:"checkbox",...e})}),h=e=>(0,u.jsx)(d,{children:(0,u.jsx)(i.Z,{type:"radio",...e})}),x=l.forwardRef(({bsPrefix:e,size:n,hasValidation:s,className:r,as:c="div",...i},d)=>{e=(0,a.vE)(e,"input-group");let m=(0,l.useMemo)(()=>({}),[]);return(0,u.jsx)(o.Z.Provider,{value:m,children:(0,u.jsx)(c,{ref:d,...i,className:t()(r,e,n&&`${e}-${n}`,s&&"has-validation")})})});x.displayName="InputGroup",n.Z=Object.assign(x,{Text:d,Radio:h,Checkbox:m})},5147:function(e,n,s){"use strict";var r=s(4184),t=s.n(r),l=s(7294),c=s(6792),a=s(5893);let i=l.forwardRef(({bsPrefix:e,className:n,striped:s,bordered:r,borderless:l,hover:i,size:o,variant:u,responsive:d,...m},h)=>{let x=(0,c.vE)(e,"table"),j=t()(n,x,u&&`${x}-${u}`,o&&`${x}-${o}`,s&&`${x}-striped`,r&&`${x}-bordered`,l&&`${x}-borderless`,i&&`${x}-hover`),f=(0,a.jsx)("table",{...m,className:j,ref:h});if(d){let p=`${x}-responsive`;return"string"==typeof d&&(p=`${p}-${d}`),(0,a.jsx)("div",{className:p,children:f})}return f});n.Z=i}},function(e){e.O(0,[774,888,179],function(){return e(e.s=9280)}),_N_E=e.O()}]);