(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[518],{9280:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/user",function(){return r(7426)}])},7426:function(e,n,r){"use strict";r.r(n),r.d(n,{__N_SSP:function(){return w},default:function(){return P}});var s=r(6042),t=r(9396),c=r(828),a=r(7297),i=r(5893),o=r(7294),l=r(1641),u=r(7283),m=r(319),d=r(682),h=r(4051),f=r(1555),x=r(2878),j=r(2318),p=r(4716),Z=r(5147),v=r(7931),g=r(5005),$=r(782),b=r(7422),y=r.n(b),k=r(2045),N=r(5043);function R(){var e=(0,a.Z)(["\n    query users($search: String!){\n      users(search: $search){\n        username\n        roles {\n          name\n        }\n      }\n\n      roles {\n        name\n        permissions\n      }\n\n      permissions\n    }\n  "]);return R=function(){return e},e}function D(){var e=(0,a.Z)(["\n  mutation updateUserRoles($username: String!, $roles: [String]!){\n    updateUserRoles(username: $username, roles: $roles)\n  }\n  "]);return D=function(){return e},e}function S(){var e=(0,a.Z)(["\n  mutation DeleteUser($username: String!){\n    deleteUser(username: $username)\n  }\n  "]);return S=function(){return e},e}function _(){var e=(0,a.Z)(["\n  mutation DeleteRole($name:String!){\n    deleteRole(name: $name)\n  }\n  "]);return _=function(){return e},e}function A(){var e=(0,a.Z)(["\n  mutation UpdateRole($key: String!, $name:String!, $permissions:[String]!){\n    updateRole(key: $key, name: $name, permissions: $permissions){\n      name\n    }\n  }\n  "]);return A=function(){return e},e}function C(){var e=(0,a.Z)(["\n  mutation CreateRole($name:String!, $permissions: [String]!){\n    createRole(name: $name, permissions: $permissions) {\n      name\n    }\n  }\n  "]);return C=function(){return e},e}var w=!0;function P(){var e=function(e){e.persist(),e.preventDefault();var n=e.target.value;n.length<3||c({search:n})},n=(0,l.a)((0,u.Ps)(R()),{variables:{search:""}}),r=n.data,c=n.refetch;return(0,i.jsxs)(d.Z,{children:[(0,i.jsx)(h.Z,{className:"site-form blackblock mt-3",children:(0,i.jsxs)(f.Z,{children:[(0,i.jsx)(h.Z,{children:(0,i.jsx)(f.Z,{children:(0,i.jsx)(x.Z.Group,{children:(0,i.jsxs)(j.Z,{children:[(0,i.jsx)(j.Z.Text,{children:"\uD83D\uDD0E"}),(0,i.jsx)(p.Z,{onChange:e})]})})})}),(0,i.jsx)(h.Z,{className:"mt-2",children:(0,i.jsx)(f.Z,{children:(0,i.jsxs)(Z.Z,{variant:"dark",hover:!0,children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Username"}),(0,i.jsx)("th",{children:"Roles"}),(0,i.jsx)("th",{})]})}),(0,i.jsx)("tbody",{children:r&&r.users.map(function(e){return(0,i.jsx)(E,(0,t.Z)((0,s.Z)({},e),{roleList:r.roles,refetch:c}),e.username)})})]})})})]})}),(0,i.jsx)(h.Z,{className:"site-form blackblock mt-3",children:(0,i.jsx)(f.Z,{children:(0,i.jsxs)(Z.Z,{variant:"dark",hover:!0,children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Role"}),r&&r.permissions.map(function(e,n){return(0,i.jsx)("th",{children:e},n)}),(0,i.jsx)("th",{})]})}),(0,i.jsx)("tbody",{children:r&&r.roles.map(function(e){return(0,i.jsx)(U,(0,t.Z)((0,s.Z)({},e),{permissionList:r.permissions}),e.name)})})]})})}),(0,i.jsx)(L,{})]})}function E(e){var n=function(){p({variables:{username:r}}).then(function(e){$.Am.success('Deleted user "'.concat(r,'" succesfully')),a()}).catch(function(e){console.log(e),$.Am.error('Failed to delete user "'.concat(r,'"'))}).finally(function(){return R(!y)})},r=e.username,s=e.roles,t=e.roleList,a=e.refetch,l=(0,c.Z)((0,m.D)((0,u.Ps)(D())),2),d=l[0],x=l[1].loading,j=(0,c.Z)((0,m.D)((0,u.Ps)(S())),2),p=j[0],Z=j[1].removeLoading,b=(0,o.useState)(!1),y=b[0],R=b[1],_=function(e){d({variables:{username:r,roles:e.map(function(e){return e.value})}}).then(function(e){$.Am.success("Updated user succesfully!")}).catch(function(e){console.log(e),$.Am.error(e.message,{autoclose:!1})})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.Z,{centered:!0,show:y,toggle:function(){return R(!y)},children:(0,i.jsxs)(v.Z.Body,{className:"m-3",style:{color:"black"},children:[(0,i.jsx)(h.Z,{children:(0,i.jsx)(f.Z,{children:'Delete user "'.concat(r,'"?')})}),(0,i.jsx)(h.Z,{className:"mt-2",children:(0,i.jsxs)(f.Z,{children:[(0,i.jsx)(g.Z,{color:"primary",className:"mx-2",onClick:n,children:Z?(0,i.jsx)(N.Z,{dev:!0}):"Yes"}),(0,i.jsx)(g.Z,{color:"primary",className:"mx-2",onClick:function(){return R(!y)},children:"No"})]})})]})}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:r}),(0,i.jsx)("td",{children:(0,i.jsx)(k.d7,{loading:x,onChange:function(e){return _(e)},defaultValue:s.map(function(e){var n=e.name;return{label:n,value:n}}),options:t.map(function(e){var n=e.name;return{label:n,value:n}})})}),(0,i.jsx)("td",{children:(0,i.jsx)(g.Z,{className:"me-2",onClick:function(){return R(!y)},children:"Remove"})})]})]})}function U(e){var n=e.name,r=e.permissions,s=e.permissionList,t=function(){h({variables:{name:n}}).then(function(e){$.Am.success('Removed "'.concat(n,'" role succesfully!'))}).catch(function(e){console.log(e),$.Am.error(e.message,{autoclose:!1})})},a=function(){var e=[];d.forEach(function(n,r){n.current.checked&&e.push(s[r])}),f({variables:{key:n,name:l.current.value,permissions:e}}).then(function(e){$.Am.success('Updated "'.concat(n,'" role succesfully!'))}).catch(function(e){console.log(e),$.Am.error(e.message,{autoclose:!1})})},l=(0,o.useRef)(null),d=(0,o.useMemo)(function(){return Array(s.length).fill().map(function(){return(0,o.createRef)()})},[s]),h=(0,c.Z)((0,m.D)((0,u.Ps)(_())),1)[0],f=(0,c.Z)((0,m.D)((0,u.Ps)(A())),1)[0];return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)("input",{style:{width:"100%"},ref:l,type:"text",className:"m-auto",defaultValue:n})}),s.map(function(e,n){return(0,i.jsx)("td",{children:(0,i.jsx)("input",{ref:d[n],type:"checkbox",className:"m-auto",defaultChecked:r.includes(e)})},e)}),(0,i.jsxs)("td",{children:[(0,i.jsx)(g.Z,{className:"me-2",onClick:a,children:"Save"}),(0,i.jsx)(g.Z,{onClick:t,children:"Remove"})]})]})}function L(){var e=function(e){e.preventDefault(),e.persist();var r=y()(e.target,{hash:!0});r.permissions=[],n({variables:r}).then(function(n){$.Am.success('Added "'.concat(e.target.elements.name.value,'" role succesfully!')),e.target.reset()}).catch(function(e){console.log(e),$.Am.error(e.message,{autoclose:!1})})},n=(0,c.Z)((0,m.D)((0,u.Ps)(C())),1)[0];return(0,i.jsx)("div",{className:"site-form blackblock mt-3 p-3",children:(0,i.jsx)(x.Z,{onSubmit:e,children:(0,i.jsxs)(h.Z,{children:[(0,i.jsx)(f.Z,{children:(0,i.jsxs)(x.Z.Group,{children:[(0,i.jsx)(x.Z.Label,{htmlFor:"name",children:"Name:"}),(0,i.jsx)(p.Z,{type:"text",name:"name",required:!0})]})}),(0,i.jsx)(f.Z,{className:"mb-3 mt-auto",children:(0,i.jsx)(g.Z,{type:"submit",color:"primary",children:"Add Role"})})]})})})}},2318:function(e,n,r){"use strict";var s=r(4184),t=r.n(s),c=r(7294),a=r(6611),i=r(6792),o=r(6558),l=r(3045),u=r(5893);let m=(0,a.Z)("input-group-text",{Component:"span"}),d=e=>(0,u.jsx)(m,{children:(0,u.jsx)(o.Z,{type:"checkbox",...e})}),h=e=>(0,u.jsx)(m,{children:(0,u.jsx)(o.Z,{type:"radio",...e})}),f=c.forwardRef(({bsPrefix:e,size:n,hasValidation:r,className:s,as:a="div",...o},m)=>{e=(0,i.vE)(e,"input-group");let d=(0,c.useMemo)(()=>({}),[]);return(0,u.jsx)(l.Z.Provider,{value:d,children:(0,u.jsx)(a,{ref:m,...o,className:t()(s,e,n&&`${e}-${n}`,r&&"has-validation")})})});f.displayName="InputGroup",n.Z=Object.assign(f,{Text:m,Radio:h,Checkbox:d})},5147:function(e,n,r){"use strict";var s=r(4184),t=r.n(s),c=r(7294),a=r(6792),i=r(5893);let o=c.forwardRef(({bsPrefix:e,className:n,striped:r,bordered:s,borderless:c,hover:o,size:l,variant:u,responsive:m,...d},h)=>{let f=(0,a.vE)(e,"table"),x=t()(n,f,u&&`${f}-${u}`,l&&`${f}-${l}`,r&&`${f}-striped`,s&&`${f}-bordered`,c&&`${f}-borderless`,o&&`${f}-hover`),j=(0,i.jsx)("table",{...d,className:x,ref:h});if(m){let p=`${f}-responsive`;return"string"==typeof m&&(p=`${p}-${m}`),(0,i.jsx)("div",{className:p,children:j})}return j});n.Z=o}},function(e){e.O(0,[774,888,179],function(){return e(e.s=9280)}),_N_E=e.O()}]);